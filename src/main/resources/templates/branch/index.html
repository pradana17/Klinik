<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" />
<title>Manage Branch</title>
<f1 th:replace="template :: header-css" />
<f1 th:replace="template :: header-js" />

</head>
<body>
	<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
		<div class="container-fluid" th:replace="template :: header-html">
			
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row flex-xl-nowrap">
			<div id="sidebar-wrapper" th:include="fragments/menu :: admin">
				
			</div>
			<div id="page-content-wrapper">
				<div class="flex-column pl-md-3 pb-md-3">
					<div class="card-block">
						<button type="button" class="btn btn-primary" data-toggle="modal"
							data-target="#addbranch" id="set">
							<i class="fas fa-plus fa-1x"></i>
						</button>
				
					</div>
				</div>
				<div class="modal fade" id="addbranch" tabindex="-1" role="dialog"
					aria-labelledby="addbranch" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="title">Add Branch</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<form action="#" th:action="@{/branch/index}"
								th:object="${branch}" method="post">
								<div class="modal-body">
									<div class="flex-column">
										<div class="form-row">
											<div class="form-group col-md-4">
												<label th:for="${branch.idbranch}">Kode Branch</label> <input
													type="text" class="form-control" id="inputkdbranch"
													placeholder="BR001" th:field="*{idbranch}" />
											</div>
											<div class="form-group col-md-8">
												<label th:for="${branch.namabranch}">Nama Branch</label> <input
													type="text" class="form-control" id="inputnmbranch"
													placeholder="Klinik Tes" th:field="*{namabranch}" />
											</div>
										</div>
										<div class="form-group">
											<label th:for="${branch.alamat}">Alamat</label> <input
												type="text" class="form-control" id="inputalmt"
												placeholder="Jalan Tomang" th:field="*{alamat}" />
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-dismiss="modal">Close</button>
									<button class="btn btn-primary" type="submit" formmethod="post"
										id="submitbranch">Submit</button>
								</div>
							</form>
						</div>
					</div>
				</div>
				<table class="table table-striped table-bordered">
					<thead class="thead-dark">
						<tr>
							<th>Kode Branch</th>
							<th>Nama Branch</th>
							<th>Alamat</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="br : ${semuabranch}">
							<td th:text="${br.idbranch}" class="kd"></td>
							<td th:text="${br.namabranch}" class="nm"></td>
							<td th:text="${br.alamat}" class="alm"></td>
							<td class="s" th:value="${br.isactive}"></td>
							<td style="width: 40px"><a href="#" class="del"><i
									class="fas fa-trash-alt"></i></a> <input type="hidden"
								class="branchIds" th:value="${br.idbranch}" /></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>


	<script>
		$(document)
				.ready(
						function() {
							$("table").dataTable();

							$(".kd")
									.dblclick(
											function() {
												var idx = $(".kd").index(this);
												var branchId = $(
														".branchIds:eq(" + idx
																+ ")").val();
												var currentName = $(this)
														.text();
												var id = "newValue-" + branchId;

												$(this)
														.html(
																'<input type="text" id="'+id+'" />');
												$("#" + id).val(currentName);
												var url = "/api/branch/changebranchkode";
												var clicked = $(this);

												$("#" + id)
														.change(
																function() {
																	var newName = $(
																			this)
																			.val();
																	$
																			.get(
																					url,
																					{
																						id : branchId,
																						kode : newName
																					})
																			.done(
																					function(
																							data) {
																						if (data)
																							$(
																									clicked)
																									.text(
																											newName);
																					});
																});
											});

							$(".nm")
									.dblclick(
											function() {
												var idx = $(".nm").index(this);
												var branchId = $(
														".branchIds:eq(" + idx
																+ ")").val();
												var currentName = $(this)
														.text();
												var id = "newValues-"
														+ branchId;

												$(this)
														.html(
																'<input type="text" id="'+id+'" />');
												$("#" + id).val(currentName);
												var url = "/api/branch/changebranchnama";
												var clicked = $(this);

												$("#" + id)
														.change(
																function() {
																	var newName = $(
																			this)
																			.val();
																	$
																			.get(
																					url,
																					{
																						id : branchId,
																						nama : newName
																					})
																			.done(
																					function(
																							data) {
																						if (data)
																							$(
																									clicked)
																									.text(
																											newName);
																					});
																});
											});

							$(".alm")
									.dblclick(
											function() {
												var idx = $(".alm").index(this);
												var branchId = $(
														".branchIds:eq(" + idx
																+ ")").val();
												var currentName = $(this)
														.text();
												var id = "newValuese-"
														+ branchId;

												$(this)
														.html(
																'<input type="text" id="'+id+'" />');
												$("#" + id).val(currentName);
												var url = "/api/branch/changebranchalamat";
												var clicked = $(this);

												$("#" + id)
														.change(
																function() {
																	var newName = $(
																			this)
																			.val();
																	$
																			.get(
																					url,
																					{
																						id : branchId,
																						alamat : newName
																					})
																			.done(
																					function(
																							data) {
																						if (data)
																							$(
																									clicked)
																									.text(
																											newName);
																					});
																});
											});

							$(".del")
									.click(
											function() {
												var idx = $(".del").index(this);
												var idBranch = $(
														".branchIds:eq(" + idx
																+ ")").val();
												var url = "/api/branch/deleteBranch";
												var choice = confirm('Do you really want to delete this record?');
												if (choice == true) {
													$.get(url, {
														idbr : idBranch
													}).done(function(data) {
														location.reload();
													});
												} else {
													return false;
												}
												;
											});
						});

		/*$(document).on("click", ".edit", function() {
		
		 var idx = $(".edit").index(this);
		 var branchId = $(".branchIds:eq("+ idx +")").val();
		
		
		 var kdbr = $("#"+idkdb).text();
		 var nmbr = $("#"+idnmb).text();
		 var almt = $("#"+idalmb).text();
		
		 var idkd = "newValue-edit" + kdbr;
		 var idnm = "newValue-edit" + nmbr;
		 var idalm = "newValue-edit" + almt;
		
		 $("#"+idkdb).html('<input type="text" id="'+idkd+'" />');
		 $("#"+idkd).val(kdbr);
		 $("#"+idnmb).html('<input type="text" id="'+idnm+'" />');
		 $("#"+idnm).val(nmbr);
		 $("#"+idalmb).html('<input type="text" id="'+idalm+'" />');
		 $("#"+idalm).val(almt);
		 var url = "/changebranch";
		 var clicked = $("#"+kdb);
		 var clicked1 = $("#"+nmb);
		 var clicked2 = $("#"+idalmb);
		
		 $("#"+id).click(function() {
		 var newName = $("#"+idkdb).val();
		 var nmbranch = $("#"+idnmb).val();
		 var alamats = $("#"+idalmb).val();
		 $.get(url,{id : branchId, kode : newName, nama : nmbranch, alamat: alamats})
		 .done(function (data) {
		 if (data) $(clicked).text(newName);
		 if (data) $(clicked1).text(nmbranch);
		 if (data) $(clicked2).text(alamats);
		 });
		 });
		
		 });*/

		$("#manage").collapse({
			toggle : true
		});

		if ($(".s").val() == 0) {
			$(".s").text("Aktif");
		} else {
			$(".s").text("Tidak Aktif");
		}
	</script>
</body>
</html>
