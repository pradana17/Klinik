<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" />
<title>Data Ahli Gizi</title>
<f1 th:replace="template :: header-css" />
<f1 th:replace="template :: header-js" />

</head>
<body>
	<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
		<div class="container-fluid" th:replace="template :: header-html">
			
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row flex-xl-nowrap">
			<div id="sidebar-wrapper" th:include="fragments/menu :: admin">
				
			</div>
			<div id="page-content-wrapper">
				<div class="flex-column pl-md-3 pb-md-3">
					<div class="card-block">
						<button type="button" class="btn btn-primary" data-toggle="modal"
							data-target="#addbranch" id="set">
							<i class="fas fa-plus fa-1x"></i>
						</button>
					</div>
				</div>
				<div class="modal fade" id="addbranch" tabindex="-1" role="dialog"
					aria-labelledby="addbranch" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="title">Add Data Nutritionist</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<form action="#" th:action="@{/admin/managenut}"
								th:object="${nut}" method="post">
								<div class="modal-body">
									<div class="flex-column">
										<div class="form-row">
											<div class="form-group col-md-6">
												<label th:for="${nut.usernutritionist}">Username</label> <input
													type="text" class="form-control" id="inputusernut"
													placeholder="wunsch" th:field="*{usernutritionist}" />
											</div>
											<div class="form-group col-md-6">
												<label th:for="${nut.password}">Password</label> <input
													type="password" class="form-control" id="inputpw"
													placeholder="" th:field="*{password}" />
											</div>
										</div>
										<div class="form-group">
											<label th:for="${nut.fullname}">Full Name</label> <input
												type="text" class="form-control" id="inputfname"
												placeholder="name" th:field="*{fullname}" />
										</div>
										<div class="form-group">
											<label th:for="${nut.email}">Email</label> <input
												type="email" class="form-control" id="inputemail"
												placeholder="user@gmail.com" th:field="*{email}" />
										</div>
										<div class="form-group">
											<label th:for="${nut.idbranch}">Branch</label> <input
												type="text" class="form-control" id="inputbranch"
												placeholder="" /> <input type="hidden" class="form-control"
												id="selectbranch" placeholder=""
												th:field="*{idbranch.idbranch}" />
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-dismiss="modal">Close</button>
									<button class="btn btn-primary" type="submit" formmethod="post"
										id="submitbranch">Submit</button>
								</div>
							</form>
						</div>
					</div>
				</div>
				<table class="table table-striped table-bordered">
					<thead class="thead-dark">
						<tr>
							<th>Username</th>
							<th>Email</th>
							<th>Full Name</th>
							<th>Branch</th>
							<th>Status</th>
							<th>Patient(s)</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="n : ${semuaNut}">
							<td th:text="${n.usernutritionist}" class="user"></td>
							<td th:text="${n.email}" class="email"></td>
							<td th:text="${n.fullname}" class="fname"></td>
							<td th:text="${n.idbranch.namabranch}" class="branch"></td>
							<td th:value="${n.isactive}" class="status"></td>
							<td th:text="${#lists.size(n.patientList)}" class="patient"></td>
							<td style="width: 40px"><a
								href="#"
								style="margin-right: 15px;" class="edit"><i
									class="fas fa-edit"></i></a> <a href="#" class="delnut"><i
									class="fas fa-trash-alt"></i></a> <input type="hidden"
								class="nutIds" th:value="${n.usernutritionist}" /></td>
						</tr>
					</tbody>
				</table>
				<div class="modal fade" id="viewNut" role="dialog"
					th:fragment="viewnut">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="titl">Edit Data Nutritionist</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<div class="flex-column"></div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<script>
		$(document).ready(function() {
			$("table").dataTable();

			if ($(".status").val() == 0) {
				$(".status").text("Aktif");
			} else {
				$(".status").text("Tidak Aktif");
			}

		});

		$(document).ready(function() {
			var branchName = [];
			var branchId = [];
			$.get("/api/branch/branchname", function(data) {
				$.each(data, function(index, value) {
					branchName.push(value);
				});
			});

			$.get("/api/branch/branchid", function(data) {
				$.each(data, function(index, value) {
					branchId.push(value);
				});
			});

			$("#inputbranch").autocomplete({
				source : branchName,
				select : function(event, ui) {
					var index = branchName.indexOf(ui.item.value);
					$("#selectbranch").val(branchId[index]);
				}
			});
			
		$(".delnut").click (function(){
				var idx = $(".delnut").index(this);
				var idNut = $(".nutIds:eq(" + idx + ")").val();
				var url = "/api/user/deleteNut";
				var choice = confirm('Do you really want to delete this record?');
			    if(choice == true) {
			    	$.get(url,{idnut :idNut})
			    	.done(function( data ) {
			    		location.reload();	
			    	});
			    } else {
			    	return false;
			    };
		    });

		});

		function openViewNut(user) {
			$.ajax({
				url : "/admin/detailnut/" + user,
				success : function(response) {
					$("#viewNutHolder").html(response);
					$("#viewNut").modal();
					$("#viewNut").modal("open");
				}
			});
		}

		$("#manage").collapse({
			toggle : true
		});
	</script>
</body>
</html>
