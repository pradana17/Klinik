<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" />
<title>Manage Patient</title>
<f1 th:replace="template :: header-css" />
<f1 th:replace="template :: header-js" />

</head>
<body>
	<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
		<div class="container-fluid" th:replace="template :: header-html">
			
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row flex-xl-nowrap">
			<div id="sidebar-wrapper" th:include="fragments/menu :: admin">
				
			</div>
			<div id="page-content-wrapper">
				<div class="flex-column pl-md-3 pb-md-3">
					<div class="card-block">
						<button type="button" class="btn btn-primary" data-toggle="modal"
							data-target="#addbranch" id="set">
							<i class="fas fa-plus fa-1x"></i>
						</button>
					</div>
				</div>
				<div class="modal fade" id="addbranch" tabindex="-1" role="dialog"
					aria-labelledby="addbranch" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="title">Add Data Patient</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<form action="#" th:action="@{/patient/index}"
								th:object="${pat}" method="post">
								<div class="modal-body">
									<div class="flex-column">
										<div class="form-row">
											<div class="form-group col-md-6">
												<label th:for="${pat.userpatient}">Username</label> <input
													type="text" class="form-control" id="inputuserpat"
													placeholder="wunsch" th:field="*{userpatient}" />
											</div>
											<div class="form-group col-md-6">
												<label th:for="${pat.password}">Password</label> <input
													type="password" class="form-control" id="inputpw"
													placeholder="" th:field="*{password}" />
											</div>
										</div>
										<div class="form-group">
											<label th:for="${pat.fullname}">Full Name</label> <input
												type="text" class="form-control" id="inputfname"
												placeholder="name" th:field="*{fullname}" />
										</div>
										<div class="form-group">
											<label th:for="${pat.email}">Email</label> <input
												type="email" class="form-control" id="inputemail"
												placeholder="user@gmail.com" th:field="*{email}" />
										</div>
										<div class="form-group">
											<label th:for="${pat.height}">Height (cm)</label> <input
												type="text" class="form-control" id="inputheight"
												placeholder="170" th:field="*{height}" />
										</div>
										<div class="form-group">
											<label th:for="${pat.weight}">Weight (kg)</label> <input
												type="text" class="form-control" id="inputweight"
												placeholder="50" th:field="*{weight}" />
										</div>
										<div class="form-group">
											<label th:for="${pat.idbranch}">Branch</label> <input
												type="text" class="form-control" id="inputbranch"
												placeholder="" /> <input type="hidden" class="form-control"
												id="selectbranch" placeholder=""
												th:field="*{idbranch.idbranch}" />
										</div>
										<div class="form-group">
											<label th:for="${pat.usernutritionist}">Nutritionist</label> 
											<input type="text" class="form-control" id="acnut" placeholder="" /> 
											<input type="hidden" class="form-control" id="selectnut" placeholder=""
												th:field="*{usernutritionist.usernutritionist}" />
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-dismiss="modal">Close</button>
									<button class="btn btn-primary" type="submit" formmethod="post"
										id="submitpat">Submit</button>
								</div>
							</form>
						</div>
					</div>
				</div>
				<table class="table table-striped table-bordered">
					<thead class="thead-dark">
						<tr>
							<th>Username</th>
							<th>Email</th>
							<th>Full Name</th>
							<th>Branch</th>
							<th>Nutritionist</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="pat : ${semuaPat}">
							<td th:text="${pat.userpatient}"></td>
							<td th:text="${pat.email}"></td>
							<td th:text="${pat.fullname}"></td>
							<td th:text="${pat.idbranch.namabranch}"></td>
							<td th:text="${pat.usernutritionist.usernutritionist}"></td>
							<td th:value="${pat.isactive}" class="status"></td>
							<td style="width: 40px"><a
								th:href="'javascript:openViewPat(' + ${pat.userpatient} +');'"
								style="margin-right: 15px;" class="edit"><i
									class="fas fa-edit"></i></a> <a href="#" class="delpat"><i
									class="fas fa-trash-alt"></i></a> <input type="hidden"
								class="patIds" th:value="${pat.userpatient}" /></td>
						</tr>
					</tbody>
				</table>
				<div class="modal fade" id="viewPat" role="dialog"
					th:fragment="viewpat">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="titl">Edit Data Patient</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<div class="flex-column"></div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<script>
		$(document).ready(function() {
			$("table").dataTable();

			if ($(".status").val() == 0) {
				$(".status").text("Aktif");
			} else {
				$(".status").text("Tidak Aktif");
			}
			
			$(".delpat").click (function(){
				var idx = $(".delpat").index(this);
				var idPat = $(".patIds:eq(" + idx + ")").val();
				var url = "/api/user/deletePat";
				var choice = confirm('Do you really want to delete this record?');
			    if(choice == true) {
			    	$.get(url,{idpat :idPat})
			    	.done(function( data ) {
			    		location.reload();	
			    	});
			    } else {
			    	return false;
			    };
		    });
			
			$("#submitpat").click(function(){
				var user = $("#inputuserpat").val();
				var url = "/api/addmember";
				$.get(url,{user : user})
				.done(function( data ) {
		    		location.reload();	
		    	});
			});
			
//			var userNut = [];
//			var ibranch = $("#selectbranch").val();
//			var url "/api/user/nutuser";
	//		$.get(url,{branch : ibranch})
	//		.done(function(data) {
	//			$.each(data, function(index, value) {
	//				userNut.push(value);
	//			});
	//		});

//			$("#acnut").autocomplete({
//				source : userNut,
//				select : function(event, ui) {
//					$("#selectnut").val(ui.item.value);
//				}
//			});
			
		});

		$(document).ready(function() {
			var branchName = [];
			var branchId = [];
			$.get("/api/branch/branchname", function(data) {
				$.each(data, function(index, value) {
					branchName.push(value);
				});
			});

			$.get("/api/branch/branchid", function(data) {
				$.each(data, function(index, value) {
					branchId.push(value);
				});
			});

			$("#inputbranch").autocomplete({
				source : branchName,
				select : function(event, ui) {
					var index = branchName.indexOf(ui.item.value);
					$("#selectbranch").val(branchId[index]);
					
					var ibranch = $("#selectbranch").val();
					var url = "/api/user/nutuser";
					$.get(url,{branch : ibranch})
					.done(function(data) {
						$("#acnut").autocomplete({
							source : data,
							select : function(event, ui) {
								$("#selectnut").val(ui.item.value);
							}
						});
					});
				}
			});
		});
		/*
		$(document).ready(function() {
			var ibranch = $("#selectbranch").val();
			alert(ibranch);
			var url = "/nutuser";
			$.get(url,{branch : ibranch})
			.done(function(data) {
				alert(data);
				$("#acnut").autocomplete({
					source : data,
					select : function(event, ui) {
						$("#selectnut").val(ui.item.value);
					}
				});
			});
		});
*/
		$("#manage").collapse({
			toggle : true
		});

		function openViewPat(user) {
			$.ajax({
				url : "/patient/detailpat/" + user,
				success : function(response) {
					$("#viewPatHolder").html(response);
					$("#viewPat").modal();
					$("#viewPat").modal("open");
				}
			});
		}
	</script>
</body>
</html>
